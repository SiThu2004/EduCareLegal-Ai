<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login & Sign Up</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<style>
.validation-message { display:flex; align-items:center; font-size:0.875rem; margin-top:0.25rem; transition:color 0.3s;}
.validation-message.valid { color:#22c55e;}
.validation-message.invalid { color:#ef4444;}
.validation-message i { width:1.25rem;}
.password-container { position: relative; }
.password-toggle { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #6b7280; }
</style>
</head>
<body class="bg-gradient-to-br from-indigo-100 via-purple-100 to-pink-100 min-h-screen flex items-center justify-center p-4">

<!-- Flash Messages -->
<!-- <div class="fixed top-4 right-4 z-50">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} p-4 mb-2 rounded-lg shadow-lg 
                    {% if category == 'error' %} bg-red-100 text-red-800 border border-red-300
                    {% else %} bg-green-100 text-green-800 border border-green-300 {% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
</div> -->

<div class="bg-white rounded-2xl shadow-2xl max-w-md w-full">
    <!-- LOGIN FORM -->
    <div id="login-form" class="p-8 md:p-12">
        <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome</h2>
        <p class="text-gray-500 mb-8">Please sign in to your account.</p>

        <form id="login" action="{{ url_for('login') }}" method="POST">
            <div class="mb-5">
                <label class="block text-gray-700 mb-2">Email Address</label>
                <input type="email" name="email" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="you@example.com" required>
            </div>
            <div class="mb-8">
                <label class="block text-gray-700 mb-2">Password</label>
                <div class="password-container">
                    <input type="password" name="password" id="login-password" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your password" required>
                    <button type="button" class="password-toggle" id="login-toggle">
                        <i class="fa-solid fa-eye"></i>
                    </button>
                </div>
            </div>
            <button type="submit" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 transition duration-300">Sign In</button>
        </form>

        <p class="text-center text-gray-500 mt-8">
            Don't have an account? <a href="#" id="show-signup" class="text-indigo-600 font-semibold hover:underline">Sign up now</a>
        </p>
    </div>

    <!-- SIGNUP FORM -->
    <div id="signup-form" class="p-8 md:p-12 hidden">
        <h2 class="text-3xl font-bold text-gray-800 mb-2">Create an Account</h2>
        <p class="text-gray-500 mb-8">Get started by creating your new account.</p>

        <form id="signup" action="{{ url_for('signup') }}" method="POST">
            <div class="mb-5">
                <label class="block text-gray-700 mb-2">Email Address</label>
                <input type="email" name="email" id="signup-email" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="you@example.com" required>
                <p id="email-error" class="text-red-500 text-sm mt-1 hidden">Please enter a valid email address.</p>
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Password</label>
                <div class="password-container">
                    <input type="password" name="password" id="signup-password" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Create a strong password" required>
                    <button type="button" class="password-toggle" id="signup-toggle">
                        <i class="fa-solid fa-eye"></i>
                    </button>
                </div>
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Confirm Password</label>
                <div class="password-container">
                    <input type="password" id="confirm-password" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Re-enter your password" required>
                    <button type="button" class="password-toggle" id="confirm-toggle">
                        <i class="fa-solid fa-eye"></i>
                    </button>
                </div>
                <p id="confirm-error" class="text-red-500 text-sm mt-1 hidden">Passwords do not match.</p>
            </div>
            <div id="password-criteria" class="space-y-1 mb-8">
                <p id="check-length" class="validation-message invalid"><i class="fa-solid fa-xmark"></i>At least 8 characters</p>
                <p id="check-lowercase" class="validation-message invalid"><i class="fa-solid fa-xmark"></i>One lowercase letter</p>
                <p id="check-uppercase" class="validation-message invalid"><i class="fa-solid fa-xmark"></i>One uppercase letter</p>
                <p id="check-digit" class="validation-message invalid"><i class="fa-solid fa-xmark"></i>One number</p>
                <p id="check-special" class="validation-message invalid"><i class="fa-solid fa-xmark"></i>One special character</p>
                <p id="check-match" class="validation-message invalid"><i class="fa-solid fa-xmark"></i>Passwords match</p>
            </div>
            <button type="submit" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 transition duration-300">Create Account</button>
        </form>

        <p class="text-center text-gray-500 mt-8">
            Already have an account? <a href="#" id="show-login" class="text-indigo-600 font-semibold hover:underline">Sign in</a>
        </p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const loginForm = document.getElementById('login-form');
    const signupForm = document.getElementById('signup-form');

    // Form switch
    document.getElementById('show-signup').addEventListener('click', e => {
        e.preventDefault();
        loginForm.classList.add('hidden');
        signupForm.classList.remove('hidden');
    });

    document.getElementById('show-login').addEventListener('click', e => {
        e.preventDefault();
        signupForm.classList.add('hidden');
        loginForm.classList.remove('hidden');
    });

    // Signup live validation
    const signupPassword = document.getElementById('signup-password');
    const confirmPassword = document.getElementById('confirm-password');
    const emailInput = document.getElementById('signup-email');
    const emailError = document.getElementById('email-error');
    const confirmError = document.getElementById('confirm-error');
    const signupFormElement = document.getElementById('signup');

    const checks = {
        length: document.getElementById('check-length'),
        lowercase: document.getElementById('check-lowercase'),
        uppercase: document.getElementById('check-uppercase'),
        digit: document.getElementById('check-digit'),
        special: document.getElementById('check-special'),
        match: document.getElementById('check-match')
    };

    // Password visibility toggle
    function setupPasswordToggle(passwordInputId, toggleButtonId) {
        const passwordInput = document.getElementById(passwordInputId);
        const toggleButton = document.getElementById(toggleButtonId);
        const icon = toggleButton.querySelector('i');
        
        toggleButton.addEventListener('click', function() {
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.replace('fa-eye', 'fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.replace('fa-eye-slash', 'fa-eye');
            }
        });
    }

    // Set up password toggles
    setupPasswordToggle('login-password', 'login-toggle');
    setupPasswordToggle('signup-password', 'signup-toggle');
    setupPasswordToggle('confirm-password', 'confirm-toggle');

    function validatePassword() {
        const pwd = signupPassword.value;
        let valid = true;
        const rules = {
            length: pwd.length >= 8,
            lowercase: /[a-z]/.test(pwd),
            uppercase: /[A-Z]/.test(pwd),
            digit: /\d/.test(pwd),
            special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(pwd)
        };
        for (const [key, ok] of Object.entries(rules)) {
            const el = checks[key];
            const icon = el.querySelector('i');
            if (ok) { 
                el.classList.replace('invalid','valid'); 
                icon.classList.replace('fa-xmark','fa-check'); 
            } else { 
                el.classList.replace('valid','invalid'); 
                icon.classList.replace('fa-check','fa-xmark'); 
                valid=false; 
            }
        }
        return valid;
    }

    function validatePasswordMatch() {
        const pwd = signupPassword.value;
        const confirm = confirmPassword.value;
        const el = checks.match;
        const icon = el.querySelector('i');
        
        if (confirm.length === 0) {
            confirmError.classList.add('hidden');
            el.classList.replace('valid','invalid'); 
            icon.classList.replace('fa-check','fa-xmark');
            return false;
        } else if (pwd === confirm) {
            confirmError.classList.add('hidden');
            el.classList.replace('invalid','valid'); 
            icon.classList.replace('fa-xmark','fa-check');
            return true;
        } else {
            confirmError.classList.remove('hidden');
            el.classList.replace('valid','invalid'); 
            icon.classList.replace('fa-check','fa-xmark');
            return false;
        }
    }

    function validateEmail() {
        const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if(regex.test(emailInput.value)) { 
            emailError.classList.add('hidden'); 
            return true;
        } else { 
            emailError.classList.remove('hidden'); 
            return false; 
        }
    }

    // Live checking on input
    signupPassword.addEventListener('input', function() {
        validatePassword();
        validatePasswordMatch();
    });
    confirmPassword.addEventListener('input', validatePasswordMatch);
    emailInput.addEventListener('input', validateEmail);

    // Form submit
    signupFormElement.addEventListener('submit', function(e) {
        if(!(validatePassword() && validateEmail() && validatePasswordMatch())) {
            e.preventDefault();
            alert(" Please fix the errors before submitting.");
        }
    });

    // Auto-hide flash messages after 5 seconds
    setTimeout(() => {
        const flashMessages = document.querySelectorAll('.alert');
        flashMessages.forEach(message => {
            message.style.transition = 'opacity 0.5s ease';
            message.style.opacity = '0';
            setTimeout(() => message.remove(), 500);
        });
    }, 5000);
});
</script>

</body>
</html>